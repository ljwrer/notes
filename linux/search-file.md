# 查找文件

- locate – 通过名字来查找文件
- find – 在一个目录层次结构中搜索文件
- xargs – 从标准输入生成和执行命令行
- touch – 更改文件时间
- stat – 显示文件或文件系统状态

### locate - 查找文件的简单方法

```bash
[me@linuxbox ~]$ locate bin/zip
```

最常见的变体是 slocate 和 mlocate

> locate 数据库来自何方？
>
> locate 数据库由另一个叫做 updatedb 的程序创建。通常，这个程序作为一个定时任务（jobs）周期性运转；也就是说，一个任务 在特定的时间间隔内被 cron 守护进程执行
>
> 所以当使用 locate 时，你会发现 目前最新的文件不会出现。为了克服这个问题，通过更改为超级用户身份，在提示符下运行 updatedb 命令， 可以手动运行 updatedb 程序。

### find - 查找文件的复杂方式

 find 程序能基于各种各样的属性 搜索一个给定目录（以及它的子目录），来查找文件。



接收一个或多个目录名来执行搜索搜索

```bash
[me@linuxbox ~]$ find ~
```

使用 wc 程序来计算出文件的数量

```bash
[me@linuxbox ~]$ find ~ | wc -l
```

在搜索中得到目录列表

```bash
[me@linuxbox ~]$ find ~ -type d | wc -l
```

限定搜索普通文件

```bash
[me@linuxbox ~]$ find ~ -type f | wc -l
```



*find 文件类型*

| 文件类型 | 描述             |
| -------- | ---------------- |
| b        | 块特殊设备文件   |
| c        | 字符特殊设备文件 |
| d        | 目录             |
| f        | 普通文件         |
| l        | 符号链接         |



查找所有文件名匹配 通配符模式“*.JPG”和文件大小大于1M 的普通文件

```bash
[me@linuxbox ~]$ find ~ -type f -name "*.JPG" -size +1M | wc -l
```



*find 大小单位*

| 字符 | 单位                                           |
| ---- | ---------------------------------------------- |
| b    | 512 个字节块。如果没有指定单位，则这是默认值。 |
| c    | 字节                                           |
| w    | 两个字节的字                                   |
| k    | 千字节(1024个字节单位)                         |
| M    | 兆字节(1048576个字节单位)                      |
| G    | 千兆字节(1073741824个字节单位)                 |



*find 测试条件*

| 测试条件       | 描述                                                         |
| -------------- | ------------------------------------------------------------ |
| -cmin n        | 匹配内容或属性最后修改时间正好在 n 分钟之前的文件或目录。 指定少于 n 分钟之前，使用 -n，指定多于 n 分钟之前，使用 +n。 |
| -cnewer file   | 匹配内容或属性最后修改时间晚于 file 的文件或目录。           |
| -ctime n       | 匹配内容和属性最后修改时间在 n*24小时之前的文件和目录。      |
| -empty         | 匹配空文件和目录。                                           |
| -group name    | 匹配属于一个组的文件或目录。组可以用组名或组 ID 来表示。     |
| -iname pattern | 就像-name 测试条件，但是不区分大小写。                       |
| -inum n        | 匹配 inode 号是 n的文件。这对于找到某个特殊 inode 的所有硬链接很有帮助。 |
| -mmin n        | 匹配内容被修改于 n 分钟之前的文件或目录。                    |
| -mtime n       | 匹配的文件或目录的内容被修改于 n*24小时之前。                |
| -name pattern  | 用指定的通配符模式匹配的文件和目录。                         |
| -newer file    | 匹配内容晚于指定的文件的文件和目录。这在编写执行备份的 shell 脚本的时候很有帮。 每次你制作一个备份，更新文件（比如说日志），然后使用 find 命令来判断哪些文件自从上一次更新之后被更改了。 |
| -nouser        | 匹配不属于一个有效用户的文件和目录。这可以用来查找 属于被删除的帐户的文件或监测攻击行为。 |
| -nogroup       | 匹配不属于一个有效的组的文件和目录。                         |
| -perm mode     | 匹配权限已经设置为指定的 mode的文件或目录。mode 可以用 八进制或符号表示法。 |
| -samefile name | 类似于-inum 测试条件。匹配和文件 name 享有同样 inode 号的文件。 |
| -size n        | 匹配大小为 n 的文件                                          |
| -type c        | 匹配文件类型是 c 的文件。                                    |
| -user name     | 匹配属于某个用户的文件或目录。这个用户可以通过用户名或用户 ID 来表示。 |



#### 操作符

查找权限不是0600的文件和权限不是0700的目录

```bash
[me@linuxbox ~]$ find ~ \( -type f -not -perm 0600 \) -or \( -type d -not -perm 0700 \)
```



*find 命令的逻辑操作符*

| 操作符 | 描述                                                         |
| ------ | ------------------------------------------------------------ |
| -and   | 如果操作符两边的测试条件都是真，则匹配。可以简写为 -a。 注意若没有使用操作符，则默认使用 -and。 |
| -or    | 若操作符两边的任一个测试条件为真，则匹配。可以简写为 -o。    |
| -not   | 若操作符后面的测试条件是真，则匹配。可以简写为一个感叹号（!）。 |
| ()     | 把测试条件和操作符组合起来形成更大的表达式。这用来控制逻辑计算的优先级。 默认情况下，find 命令按照从左到右的顺序计算。经常有必要重写默认的求值顺序，以得到期望的结果。 即使没有必要，有时候包括组合起来的字符，对提高命令的可读性是很有帮助的。注意 因为圆括号字符对于 shell 来说有特殊含义，所以在命令行中使用它们的时候，它们必须 用引号引起来，才能作为实参传递给 find 命令。通常反斜杠字符被用来转义圆括号字符。 |



```bash
( expression 1 ) -or ( expression 2 )
```



因为圆括号对于 shell 有特殊含义，我们必须转义它们，来阻止 shell 解释它们。在圆括号字符 之前加上一个反斜杠字符来转义它们



```bash
expr1 -operator expr2
```



*find AND/OR 逻辑*

| expr1 的结果 | 操作符 | expr2 is... |
| ------------ | ------ | ----------- |
| True         | -and   | 总要执行    |
| False        | -and   | 从不执行    |
| Ture         | -or    | 从不执行    |
| False        | -or    | 总要执行    |

我们能依靠这种行为来控制怎样来执行操作



### 预定义的操作

*几个预定义的 find 命令操作*

| 操作    | 描述                                                         |
| ------- | ------------------------------------------------------------ |
| -delete | 删除当前匹配的文件。                                         |
| -ls     | 对匹配的文件执行等同的 ls -dils 命令。并将结果发送到标准输出。 |
| -print  | 把匹配文件的全路径名输送到标准输出。如果没有指定其它操作，这是 默认操作。 |
| -quit   | 一旦找到一个匹配，退出。                                     |

默认使用-print 操作

```bash
find ~
# 结果一致
find ~ -print
```

删除扩展名为“.BAK”（这通常用来指定备份文件） 的文件

```bash
find ~ -type f -name '*.BAK' -delete
# 结果一致
find ~ -type f -and -name '*.BAK' -and -print
```

每个测试和操作之间会默认应用 -and 逻辑运算符



| 测试／行为    | 只有...的时候，才被执行                                |
| ------------- | ------------------------------------------------------ |
| -print        | 只有 -type f and -name '*.BAK'为真的时候               |
| -name ‘*.BAK’ | 只有 -type f 为真的时候                                |
| -type f       | 总是被执行，因为它是与 -and 关系中的第一个测试／行为。 |

 知道测试和行为的顺序很重要



### 用户定义的行为

command 就是指一个命令的名字，{}是当前路径名的符号表示，分号是必要的分隔符 表明命令的结束

```bash
-exec command {} ;
```



```bash
-delete
# 结果一致
-exec rm '{}' ';'
```

因为花括号和分号对于 shell 有特殊含义，所以它们必须被引起来或被转义



通过使用 -ok 行为来代替 -exec，在执行每个指定的命令之前， 会提示用户

```bash
find ~ -type f -name 'foo*' -ok ls -l '{}' ';'
< ls ... /home/me/bin/foo > ? y
-rwxr-xr-x 1 me    me 224 2007-10-29 18:44 /home/me/bin/foo
< ls ... /home/me/foo.txt > ? y
-rw-r--r-- 1 me    me 0 2008-09-19 12:53 /home/me/foo.txt
```



### 提高效率

当 -exec 行为被使用的时候，若每次找到一个匹配的文件，它会启动一个新的指定命令的实例。 我们可能更愿意把所有的搜索结果结合起来，再运行一个命令的实例

传统方式是使用外部命令 xargs，另一种方法是，使用 find 命令自己的一个新功能



```bash
find ~ -type f -name 'foo*' -exec ls -l '{}' ';'
-rwxr-xr-x 1 me     me 224 2007-10-29 18:44 /home/me/bin/foo
-rw-r--r-- 1 me     me 0 2008-09-19 12:53 /home/me/foo.txt
```



#### xargs

从标准输入接受输入，并把输入转换为一个特定命令的 参数列表

```bash
# xargs 会为 ls 命令构建 参数列表，然后执行 ls 命令
find ~ -type f -name 'foo*' -print | xargs ls -l
-rwxr-xr-x 1 me     me 224 2007-10-29 18:44 /home/me/bin/foo
-rw-r--r-- 1 me     me 0 2008-09-19 12:53 /home/me/foo.txt
```

> 当被放置到命令行中的参数个数相当大时，参数个数是有限制的。有可能创建的命令 太长以至于 shell 不能接受。当命令行超过系统支持的最大长度时，xargs 会执行带有最大 参数个数的指定命令，然后重复这个过程直到耗尽标准输入。执行带有 –show–limits 选项 的 xargs 命令，来查看命令行的最大值



*find 命令选项*

| 选项             | 描述                                                         |
| ---------------- | ------------------------------------------------------------ |
| -depth           | 指示 find 程序先处理目录中的文件，再处理目录自身。当指定-delete 行为时，会自动 应用这个选项。 |
| -maxdepth levels | 当执行测试条件和行为的时候，设置 find 程序陷入目录树的最大级别数 |
| -mindepth levels | 在应用测试条件和行为之前，设置 find 程序陷入目录数的最小级别数。 |
| -mount           | 指示 find 程序不要搜索挂载到其它文件系统上的目录。           |
| -noleaf          | 指示 find 程序不要基于自己在搜索 Unix 的文件系统的假设，来优化它的搜索。 在搜索DOS/Windows 文件系统和CD/ROMS的时候，我们需要这个选项 |



> 程序 locate，updatedb，find 和 xargs 都是 GNU 项目 findutils 软件包的一部分

