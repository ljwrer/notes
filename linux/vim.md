# vi简介

### 启动和退出 vi

```bash
# 启动
[me@linuxbox ~]$ vi
# 退出
:q
# 强制退出,忽略修改
:q!
```



#### 兼容模式

```bash
echo “set nocp” >> ~/.vimrc
```



### 编辑模式

```Bash
[me@linuxbox ~]$ vi foo.txt
```

每行开头的波浪号（”~”）表示那一行没有文本

vi 是一个模式编辑器。vi 启动后会直接进入 命令模式。这种模式下，几乎每个按键都是一个命令

#### 插入模式

按下”i”键进入插入模式

```Bash
-- INSERT --
```

#### 保存

在命令模式下通过按下”:”键输入一个 ex 命令。 

文件写入到硬盘

```Bash
:w
```

> vim 的文档，你会发现命令模式被（令人困惑地）叫做普通模式，ex 命令 叫做命令模式。当心。



### 移动光标

 vi 命令模式下时，vi 提供了大量的移动命令，其中一些与 less 阅读器的相同

##### 光标移动按键

| 按键                | 移动光标                                          |
| ------------------- | ------------------------------------------------- |
| l or 右箭头         | 向右移动一个字符                                  |
| h or 左箭头         | 向左移动一个字符                                  |
| j or 下箭头         | 向下移动一行                                      |
| k or 上箭头         | 向上移动一行                                      |
| 0 (零按键)          | 移动到当前行的行首。                              |
| ^                   | 移动到当前行的第一个非空字符。                    |
| $                   | 移动到当前行的末尾。                              |
| w                   | 移动到下一个单词或标点符号的开头。                |
| W                   | 移动到下一个单词的开头，忽略标点符号。            |
| b                   | 移动到上一个单词或标点符号的开头。                |
| B                   | 移动到上一个单词的开头，忽略标点符号。            |
| Ctrl-f or Page Down | 向下翻一页                                        |
| Ctrl-b or Page Up   | 向上翻一页                                        |
| numberG             | 移动到第 number 行。例如，1G 移动到文件的第一行。 |
| G                   | 移动到文件末尾。                                  |

> vi 中的许多命令都可以在前面加上一个数字，比方说上面提到的”G”命令。在命令之前加上一个 数字，我们就可以指定命令执行的次数。例如，命令”5j”将光标下移5行。



### 基本编辑

撤销功能: u

#### 追加文本

A:光标就会越过行尾，同时 vi 会进入插入模式

#### 打开一行

在两行之间插入一个空白行，并且进入到插入模式

| 命令 | 打开行                 |
| ---- | ---------------------- |
| o    | 当前行的下方打开一行。 |
| O    | 当前行的上方打开一行。 |

#### 删除文本

| 命令   | 删除的文本                               |
| ------ | ---------------------------------------- |
| x      | 当前字符                                 |
| 3x     | 当前字符及其后的两个字符。               |
| **dd** | 当前行。                                 |
| 5dd    | 当前行及随后的四行文本。                 |
| dW     | 从光标位置开始到下一个单词的开头。       |
| **d$** | 从光标位置开始到当前行的行尾。           |
| **d0** | 从光标位置开始到当前行的行首。           |
| d^     | 从光标位置开始到文本行的第一个非空字符。 |
| dG     | 从当前行到文件的末尾。                   |
| d20G   | 从当前行到文件的第20行。                 |

#### 剪切，复制和粘贴文本

d 命令不仅删除文本，它还“剪切”文本

每次我们使用 d 命令，删除的部分被复制到一个 粘贴缓冲区中（看作剪切板）

小 p 命令把剪切板中的文本粘贴到光标位置之后， 或者是大 P 命令把文本粘贴到光标之前



y 命令用来“拉”（复制）文本

##### 复制命令

| 命令   | 复制的内容                               |
| ------ | ---------------------------------------- |
| **yy** | 当前行。                                 |
| 5yy    | 当前行及随后的四行文本。                 |
| yW     | 从当前光标位置到下一个单词的开头。       |
| **y$** | 从当前光标位置到当前行的末尾。           |
| **y0** | 从当前光标位置到行首。                   |
| y^     | 从当前光标位置到文本行的第一个非空字符。 |
| yG     | 从当前行到文件末尾。                     |
| y20G   | 从当前行到文件的第20行。                 |

#### 连接行

输入大写的 J 命令链接行与行



### 查找和替换

#### 查找一行

f 命令能搜索一特定行，并将光标移动到下一个匹配的字符上

命令 fa 会把光标定位到同一行中 下一个出现的”a”字符上

在进行了一次行内搜索后，输入分号能重复这次搜索

#### 查找整个文件

使用 / 命令。这个命令和 less 程序中一样

通过 n 命令来重复先前的查找

#### 全局查找和替代

使用 ex 命令来执行查找和替代操作

```bash
:%s/Line/line/g
```

| 条目       | 含义                                                         |
| ---------- | ------------------------------------------------------------ |
| :          | 冒号字符运行一个 ex 命令。                                   |
| %          | 指定要操作的行数。% 是一个快捷方式，表示从第一行到最后一行。另外，操作范围也 可以用 1,5 来代替（因为我们的文件只有5行文本），或者用 1,$ 来代替，意思是 “ 从第一行到文件的最后一行。” 如果省略了文本行的范围，那么操作只对当前行生效。 |
| s          | 指定操作。在这种情况下是，替换（查找与替代）。               |
| /Line/line | 查找类型与替代文本。                                         |
| g          | 这是“全局”的意思，意味着对文本行中所有匹配的字符串执行查找和替换操作。如果省略 g，则 只替换每个文本行中第一个匹配的字符串。 |

可以指定一个需要用户确认的替换命令。通过添加一个”c”字符到这个命令的末尾，来完成 这个替换命令

```bash
:%s/line/Line/gc
```

在执行每个替换命令之前，vi 会停下来， 通过下面的信息，来要求我们确认这个替换：

```bash
replace with Line (y/n/a/q/l/^E/^Y)?
```

##### 替换确认按键

| 按键           | 行为                                                 |
| -------------- | ---------------------------------------------------- |
| y              | 执行替换操作                                         |
| n              | 跳过这个匹配的实例                                   |
| a              | 对这个及随后所有匹配的字符串执行替换操作。           |
| q or esc       | 退出替换操作。                                       |
| l              | 执行这次替换并退出。l 是 “last” 的简写。             |
| Ctrl-e, Ctrl-y | 分别是向下滚动和向上滚动。用于查看建议替换的上下文。 |



### 编辑多个文件

```bash
vi file1 file2 file3...
```

#### 文件之间切换

从这个文件切换下一个文件，使用这个 ex 命令：

```bash
:n
```

回到先前的文件使用：

```bash
:N
```

查看正在编辑的文件列表，使用:buffers 命令

```bash
:buffers
1 #     "foo.txt"                 line 1
2 %a    "ls-output.txt"           line 0
Press ENTER or type command to continue
```

切换到另一个缓冲区（文件），输入 :buffer, 紧跟着你想要编辑的缓冲器编号

```bash
:buffer 2
```

#### 打开另一个文件并编辑

```bash
:e ls-output.txt
```

>当文件由 ：e 命令加载，你将无法用 :n 或 :N 命令来切换文件。 这时要使用 :buffer 命令加缓冲区号码，来切换文件

#### 跨文件复制黏贴

首先转换到缓冲区1

```bash
:buffer 1
```

下一步，把光标移到一行，并且输入 yy 来复制这一行

转换到第二个缓冲区，输入：

```bash
:buffer 2
```

移动光标到第一行，输入 p 命令把我们从前面文件中复制的一行粘贴到这个文件中

#### 插入整个文件到另一个文件

:r 命令（是”read”的简称）把指定的文件插入到光标位置之前

```
:r foo.txt
```



### 保存工作

在命令模式下，输入 ZZ 就会保存并退出当前文件。

同样地，ex 命令:wq 把:w 和:q 命令结合到 一起，来完成保存和退出任务。

保存一个副本，叫做 foo1.txt

```bash
:w foo1.txt
```

> 当上面的命令以一个新名字保存文件时，它并没有更改你正在编辑的文件的名字。 如果你继续编辑，你还是在编辑文件 foo.txt，而不是 foo1.txt

